<head>
  <link
    href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
    rel="stylesheet"
  />
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.6.1/web3.min.js"
    integrity="sha512-5erpERW8MxcHDF7Xea9eBQPiRtxbse70pFcaHJuOhdEBQeAxGQjUwgJbuBDWve+xP/u5IoJbKjyJk50qCnMD7A=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
</head>

<body class="h-full">
  <div
    class="
      flex
      w-full
      h-full
      justify-center
      content-center
      items-center
      space-x-4
    "
  >
    <div class="flex flex-col space-y-6">
      <h3 class="text-center">Working with Web3.js!</h3>
      <div class="flex flex-col space-y-2">
        <button
          onclick="loginWithEth()"
          class="
            rounded
            bg-white
            border border-gray-400
            hover:bg-gray-100
            py-2
            px-4
            text-gray-600
            hover:text-gray-700
          "
        >
          Login & Save ETH Address
        </button>
        
        <p id="userAddress" class="text-gray-600"></p>

        <button
          id="logoutButton"
          onclick="logout()"
          class="hidden text-blue-500 underline"
        >
          Logout
        </button>
      </div>
      <button
        id="getContractInfo"
        onclick="getContractSymbol()"
        class="rounded bg-blue-500 hover:bg-blue-700 py-2 px-4 text-white"
      >
        Get Contract Symbol
      </button>
      <div class="flex flex-col space-y-2"></div>
    </div>
  </div>

  <script type="text/javascript">
    window.userAddress = null;
  	window.onload = async () => {
      // inicializa web3 conectado ao ETH
  		if (window.ethereum) {
  			window.web3 = new Web3(ethereum);
       } else {
        alert('no ether browser extension detected.');
      }

      // carrega o localstore key
     window.userAddress = window.localStorage.getItem('userAddress');
      showAddress()
    }


     function showAddress() {
      if (!window.userAddress) {
        document.getElementById("userAddress").innerText = "";
        document.getElementById("logoutButton").classList.add("hidden");
        return false;
      } 

       document.getElementById("userAddress").innerText = `ETH Address: ${window.userAddress}`;
        document.getElementById("logoutButton").classList.remove("hidden");
      }
    


  	async function loginWithEth() {
  		if(window.web3) {
  			try {
  				const accounts = await ethereum.request({ 
            method: 'eth_requestAccounts' 
          });
          window.userAddress = accounts[0];
  				// salva endereco do usuario no storage do navegador
          window.localStorage.setItem('userAddress' , accounts[0])
          showAddress();
  			} catch(error) {
  				  console.error(error);
  				}
  				
    		} else {
    			alert('no ether browser extension detected.');
    		}
  	}

    function logout() {
      window.userAddress = null;
      window.localStorage.removeItem('userAddress');
      showAddress();
      window.ethereum.on('accountsChanged', async () => {
          initialise();
      });
      window.location.reload();
    }

  </script>